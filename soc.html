<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Axentra SOC - Threat Map</title>
    <script src="https://unpkg.com/three@0.150.1/build/three.min.js"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <style>
        body {
            margin: 0;
            background: #121d2b;
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
        }
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 230px;
            height: 100%;
            background: #182535;
            color: #ffd600;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }
        .sidebar h1 {
            padding: 30px 0 10px 25px;
            margin: 0;
            font-size: 2.1em;
        }
        .sidebar .nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-top: 20px;
        }
        .sidebar .nav a {
            color: #ffd600;
            text-decoration: none;
            padding: 16px 0 16px 35px;
            font-size: 1.3em;
            transition: background 0.2s;
        }
        .sidebar .nav a.active, .sidebar .nav a:hover {
            background: #232c3b;
            color: #fff;
        }
        .sidebar .logout-btn {
            margin: 25px;
            padding: 15px;
            font-size: 1.1em;
            background: #ffd600;
            color: #232c3b;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 6px 20px #232c3b44;
            transition: background 0.2s;
        }
        .main-content {
            margin-left: 230px;
            padding: 35px 50px 10px 50px;
        }
        .box {
            background: #202734;
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 45px;
        }
        .threat-map-title {
            color: #ffd600;
            font-size: 2.3em;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }
        .threat-map-legend {
            margin-top: 18px;
            font-size: 1.13em;
        }
        .threat-map-legend span {
            font-weight: bold;
        }
        .threat-map-legend .red { color: #ff4b4b; }
        .threat-map-legend .orange { color: #ff9800; }
        .threat-map-legend .yellow { color: #ffd600; }
        #globeViz {
            margin: 0 auto;
            display: block;
            width: 500px;
            height: 500px;
            background: #161d27;
            border-radius: 20px;
            box-shadow: 0 10px 32px #161d2744;
        }
        @media (max-width: 900px) {
            .main-content { padding: 10px; }
            #globeViz { width: 99vw; height: 400px; }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h1>Axentra SOC</h1>
        <div class="nav">
            <a href="index.html">Dashboard</a>
            <a href="#" >Incidents</a>
            <a href="#" class="active">Threat Map</a>
            <a href="#">Users</a>
            <a href="#">Forensics</a>
        </div>
        <button class="logout-btn">Logout</button>
    </div>
    <div class="main-content">
        <div class="box">
            <div class="threat-map-title">Threat Map</div>
            <div id="globeViz"></div>
            <div class="threat-map-legend">
                <span class="red">Red:</span> Active attacks
                <span class="orange">Orange:</span> Recent attempts
                <span class="yellow">Yellow:</span> Suspicious activity
            </div>
        </div>
    </div>
    <script>
        // Example: countries to highlight by type
        const threatCountries = [
            { name: "Russia", color: "red", label: "Active attacks" },
            { name: "China", color: "red", label: "Active attacks" },
            { name: "Iran", color: "orange", label: "Recent attempts" },
            { name: "Malaysia", color: "yellow", label: "Suspicious activity" },
            { name: "North Korea", color: "red", label: "Active attacks" },
            { name: "Brazil", color: "orange", label: "Recent attempts" }
        ];

        fetch('https://unpkg.com/world-atlas@2.0.2/countries-110m.json').then(res => res.json()).then(countries => {
            const countriesGeo = window.topojson.feature(countries, countries.objects.countries).features;

            // Assign color per country
            countriesGeo.forEach(feat => {
                const match = threatCountries.find(tc => feat.properties.name === tc.name);
                feat.properties.color = match ? match.color : "#232c3b";
                feat.properties.threatLabel = match ? match.label : "";
            });

            const globe = Globe()
                (document.getElementById('globeViz'))
                .globeImageUrl('//unpkg.com/three-globe/example/img/earth-dark.jpg')
                .backgroundColor('rgba(0,0,0,0)')
                .polygonsData(countriesGeo)
                .polygonCapColor(feat => {
                    if(feat.properties.color === "red") return "rgba(255,75,75,0.80)";
                    if(feat.properties.color === "orange") return "rgba(255,152,0,0.75)";
                    if(feat.properties.color === "yellow") return "rgba(255,214,0,0.70)";
                    return "rgba(30,40,50,0.5)";
                })
                .polygonSideColor(() => 'rgba(30,40,50,0.09)')
                .polygonStrokeColor(() => '#1a2230')
                .onPolygonHover((feat) => {
                    document.body.style.cursor = feat ? 'pointer' : '';
                })
                .polygonsTransitionDuration(350)
                .polygonLabel(feat => `
                    <div style="color: #ffd600; font-weight:bold; font-size:1.2em;">
                        ${feat.properties.name}
                    </div>
                    <div style="color:#fff;font-size:1em;">
                        ${feat.properties.threatLabel}
                    </div>
                `);

            // Initial view
            globe.pointOfView({ lat: 36, lng: 30, altitude: 2.1 });
        });

        // Load TopoJSON script for country shapes
        (function(){
            var s = document.createElement('script');
            s.src = 'https://unpkg.com/topojson@3';
            document.head.appendChild(s);
        })();
    </script>
</body>
</html>
