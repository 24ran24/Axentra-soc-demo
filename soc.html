<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Axentra SOC - Threat Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Globe.gl + dependencies -->
    <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <style>
        body {
            margin: 0;
            background: #101c2a;
            font-family: 'IBM Plex Sans', Arial, sans-serif;
        }
        .threat-map-container {
            background: #232c3c;
            border-radius: 28px;
            box-shadow: 0 2px 36px 0 #08121d90;
            max-width: 900px;
            width: 98%;
            margin: 48px auto 0 auto;
            padding: 32px 30px 20px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h2 {
            color: #ffd600;
            font-size: 34px;
            margin-bottom: 20px;
        }
        #globeViz {
            width: 540px;
            height: 540px;
            margin-bottom: 18px;
        }
        .threat-legend {
            color: #fff;
            font-size: 17px;
            margin-top: 14px;
            margin-bottom: 5px;
            text-align: left;
            width: 100%;
        }
        .threat-legend span {
            font-weight: bold;
        }
        .threat-legend .red { color: #FF4444; }
        .threat-legend .orange { color: #FFA500; }
        .threat-legend .yellow { color: #FFF700; }
        @media (max-width: 650px) {
            #globeViz { width: 98vw; height: 52vw; min-height: 320px;}
        }
        /* Tooltip styles */
        .country-tooltip {
            position: fixed;
            z-index: 9999;
            background: #232c3cf9;
            color: #ffd600;
            border-radius: 9px;
            padding: 7px 16px 6px 12px;
            box-shadow: 0 2px 12px #0005;
            pointer-events: none;
            font-size: 17px;
            font-weight: 600;
            transition: opacity 0.15s;
        }
    </style>
</head>
<body>
    <div class="threat-map-container">
        <h2>Threat Map</h2>
        <div id="globeViz"></div>
        <div class="threat-legend">
            <span class="red">Red:</span> Active attacks&nbsp;&nbsp;
            <span class="orange">Orange:</span> Recent attempts&nbsp;&nbsp;
            <span class="yellow">Yellow:</span> Suspicious activity
        </div>
    </div>
    <div id="country-tooltip" class="country-tooltip" style="opacity:0"></div>
    <script>
        // Define countries with threats
        // Format: { name: 'Country Name', threat: 'red' | 'orange' | 'yellow', label: 'Type of threat' }
        const THREAT_COUNTRIES = [
            { name: 'Russia', threat: 'red', label: 'Active attacks' },
            { name: 'China', threat: 'red', label: 'Active attacks' },
            { name: 'Malaysia', threat: 'orange', label: 'Recent attempts' },
            { name: 'Iran', threat: 'red', label: 'Active attacks' },
            { name: 'North Korea', threat: 'yellow', label: 'Suspicious activity' },
            { name: 'Brazil', threat: 'orange', label: 'Recent attempts' },
            { name: 'Ukraine', threat: 'yellow', label: 'Suspicious activity' },
            { name: 'USA', threat: 'orange', label: 'Recent attempts' }
        ];

        // Threat colors
        const THREAT_COLORS = {
            'red': '#FF4444',
            'orange': '#FFA500',
            'yellow': '#FFF700'
        };

        // Load world topojson
        fetch('https://unpkg.com/world-atlas@2.0.2/countries-110m.json')
        .then(res => res.json())
        .then(countriesTopo => {
            // Convert to geojson
            const countries = window.topojson.feature(countriesTopo, countriesTopo.objects.countries).features;
            // Map country names to threats
            countries.forEach(c => {
                const found = THREAT_COUNTRIES.find(tc => tc.name.toLowerCase() === c.properties.name.toLowerCase());
                if (found) {
                    c.threat = found.threat;
                    c.threatLabel = found.label;
                }
            });

            // Init globe
            const globe = Globe()
                (document.getElementById('globeViz'))
                .globeImageUrl('//unpkg.com/three-globe/example/img/earth-dark.jpg')
                .backgroundColor('#101c2a')
                .polygonsData(countries)
                .polygonAltitude(d => d.threat ? 0.08 : 0.01)
                .polygonCapColor(d => d.threat ? THREAT_COLORS[d.threat] : 'rgba(80,120,190,0.15)')
                .polygonSideColor(() => 'rgba(30,40,50,0.20)')
                .polygonStrokeColor(d => d.threat ? '#fff' : '#aee0ff10')
                .polygonLabel(d => d.threat ? `<b>${d.properties.name}</b><br/>${d.threatLabel}` : `<b>${d.properties.name}</b>`)
                .polygonsTransitionDuration(400)
                .onPolygonHover((polygon) => {
                    // Tooltip on hover
                    const tooltip = document.getElementById('country-tooltip');
                    if (polygon && polygon.threat) {
                        tooltip.innerHTML = `<b>${polygon.properties.name}</b><br><span style="color:${THREAT_COLORS[polygon.threat]};">${polygon.threatLabel}</span>`;
                        tooltip.style.opacity = 1;
                    } else {
                        tooltip.style.opacity = 0;
                    }
                });

            // Tooltip follow mouse
            document.addEventListener('mousemove', e => {
                const tooltip = document.getElementById('country-tooltip');
                tooltip.style.left = (e.clientX + 15) + 'px';
                tooltip.style.top = (e.clientY - 20) + 'px';
            });
        });

        // Inject topojson script (required for world-atlas)
        (function(){
            var s = document.createElement('script');
            s.src = 'https://unpkg.com/topojson-client@3.1.0/dist/topojson-client.min.js';
            document.body.appendChild(s);
        })();
    </script>
</body>
</html>
